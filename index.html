<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Web Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #0d1b2a;
            color: #f0f0f0;
            overflow: hidden;
            height: 100vh;
        }
        
        #game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        #header {
            padding: 12px 20px;
            background-color: rgba(13, 27, 42, 0.95);
            border-bottom: 3px solid #1b3a4b;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 28px;
            box-shadow: 0 0 10px rgba(78, 205, 196, 0.5);
        }
        
        h1 {
            color: #4ecdc4;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            font-size: 32px;
            letter-spacing: 1px;
        }
        
        .game-stats {
            display: flex;
            gap: 25px;
            font-size: 18px;
        }
        
        .stat-item {
            background-color: rgba(27, 58, 75, 0.7);
            padding: 8px 15px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-icon {
            color: #4ecdc4;
            font-weight: bold;
        }
        
        #main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        #sidebar {
            width: 280px;
            background-color: rgba(13, 27, 42, 0.9);
            border-right: 2px solid #1b3a4b;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            overflow-y: auto;
            transition: transform 0.3s;
        }
        
        .sidebar-section {
            background-color: rgba(27, 58, 75, 0.6);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(78, 205, 196, 0.3);
        }
        
        .section-title {
            color: #4ecdc4;
            font-size: 20px;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(78, 205, 196, 0.5);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title::before {
            content: "‚ñ†";
            font-size: 24px;
        }
        
        #inventory {
            min-height: 250px;
        }
        
        .inventory-slots {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .inventory-slot {
            width: 55px;
            height: 55px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .inventory-slot:hover {
            background-color: rgba(255, 255, 255, 0.15);
            border-color: #4ecdc4;
        }
        
        .inventory-slot.selected {
            background-color: rgba(78, 205, 196, 0.2);
            border-color: #4ecdc4;
            transform: scale(1.05);
        }
        
        .slot-count {
            position: absolute;
            bottom: 3px;
            right: 5px;
            font-size: 14px;
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }
        
        .block-preview {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            margin-bottom: 3px;
        }
        
        .slot-name {
            font-size: 11px;
            text-align: center;
            color: #ccc;
        }
        
        #crafting {
            min-height: 300px;
        }
        
        .crafting-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 15px;
            background-color: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 5px;
        }
        
        .crafting-slot {
            width: 50px;
            height: 50px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #craft-result {
            width: 60px;
            height: 60px;
            background-color: rgba(27, 58, 75, 0.8);
            border: 2px solid #4ecdc4;
            border-radius: 6px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .craft-btn {
            width: 100%;
            padding: 12px;
            background-color: #1b6ca8;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .craft-btn:hover {
            background-color: #4ecdc4;
            transform: translateY(-2px);
        }
        
        .craft-btn:disabled {
            background-color: #555;
            cursor: not-allowed;
            transform: none;
        }
        
        #player-info {
            background-color: rgba(27, 58, 75, 0.7);
            padding: 15px;
            border-radius: 10px;
        }
        
        .health-bar, .food-bar {
            height: 20px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .health-fill {
            height: 100%;
            background: linear-gradient(to right, #ff416c, #ff4b2b);
            border-radius: 10px;
            width: 100%;
            transition: width 0.5s;
        }
        
        .food-fill {
            height: 100%;
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            border-radius: 10px;
            width: 100%;
            transition: width 0.5s;
        }
        
        .bar-label {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }
        
        #canvas-wrapper {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        #game-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        #mobile-controls {
            display: none;
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            justify-content: space-between;
            z-index: 50;
        }
        
        .mobile-btn {
            width: 70px;
            height: 70px;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            user-select: none;
        }
        
        #toggle-sidebar {
            position: absolute;
            top: 100px;
            left: 10px;
            width: 40px;
            height: 40px;
            background-color: rgba(27, 58, 75, 0.9);
            border: 2px solid #4ecdc4;
            border-radius: 0 5px 5px 0;
            color: #4ecdc4;
            font-size: 20px;
            cursor: pointer;
            z-index: 99;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0d1b2a 0%, #1b3a4b 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 1s;
        }
        
        .loader {
            width: 80px;
            height: 80px;
            border: 8px solid rgba(78, 205, 196, 0.2);
            border-top: 8px solid #4ecdc4;
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
            margin-bottom: 30px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 24px;
            color: #4ecdc4;
            margin-bottom: 10px;
        }
        
        .loading-subtext {
            color: #89c2d9;
            margin-bottom: 30px;
        }
        
        .progress-bar {
            width: 300px;
            height: 20px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #4ecdc4, #1b6ca8);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s;
        }
        
        #hotbar {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 90;
        }
        
        .hotbar-slot {
            width: 70px;
            height: 70px;
            background-color: rgba(0, 0, 0, 0.6);
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.2s;
        }
        
        .hotbar-slot.selected {
            border-color: #4ecdc4;
            background-color: rgba(78, 205, 196, 0.2);
            transform: translateY(-5px);
        }
        
        .hotbar-number {
            position: absolute;
            top: 5px;
            left: 5px;
            background-color: rgba(0, 0, 0, 0.7);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }
        
        #minimap {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 180px;
            height: 180px;
            background-color: rgba(0, 0, 0, 0.7);
            border: 3px solid #4ecdc4;
            border-radius: 10px;
            z-index: 80;
            overflow: hidden;
        }
        
        .block {
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-right: 5px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .grass { background-color: #7CFC00; }
        .dirt { background-color: #8B4513; }
        .stone { background-color: #808080; }
        .wood { background-color: #8B7355; }
        .leaf { background-color: #32CD32; }
        .glass { background-color: rgba(173, 216, 230, 0.7); }
        .plank { background-color: #DEB887; }
        .stick { background-color: #D2B48C; }
        .coal { background-color: #333; }
        .iron { background-color: #C0C0C0; }
        .diamond { background-color: #4EE2EC; }
        
        @media (max-width: 1200px) {
            #sidebar {
                position: absolute;
                left: 0;
                top: 0;
                height: 100%;
                z-index: 100;
                transform: translateX(-100%);
            }
            
            #sidebar.open {
                transform: translateX(0);
            }
            
            #toggle-sidebar {
                display: flex;
            }
            
            .game-stats {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        @media (max-width: 768px) {
            #mobile-controls {
                display: flex;
            }
            
            #minimap {
                width: 120px;
                height: 120px;
                top: 80px;
            }
            
            .hotbar-slot {
                width: 60px;
                height: 60px;
            }
            
            h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="header">
            <div class="logo">
                <div class="logo-icon">M</div>
                <h1>Minecraft Web Edition</h1>
            </div>
            
            <div class="game-stats">
                <div class="stat-item">
                    <span class="stat-icon">‚õèÔ∏è</span>
                    <span>–ë–ª–æ–∫–æ–≤: <span id="block-count">0</span></span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üìç</span>
                    <span id="coordinates">X: 0, Y: 5, Z: 0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">‚è±Ô∏è</span>
                    <span id="game-time">–î–µ–Ω—å</span>
                </div>
            </div>
        </div>
        
        <div id="main-content">
            <div id="sidebar">
                <div class="sidebar-section" id="inventory">
                    <div class="section-title">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
                    <div class="inventory-slots" id="inventory-slots">
                        <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                    </div>
                </div>
                
                <div class="sidebar-section" id="crafting">
                    <div class="section-title">–ö—Ä–∞—Ñ—Ç</div>
                    <div class="crafting-grid" id="crafting-grid">
                        <!-- –°–ª–æ—Ç—ã –∫—Ä–∞—Ñ—Ç–∞ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                    </div>
                    <div id="craft-result">
                        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –∫—Ä–∞—Ñ—Ç–∞ -->
                    </div>
                    <button id="craft-btn" class="craft-btn" disabled>–°–æ–∑–¥–∞—Ç—å</button>
                </div>
                
                <div class="sidebar-section" id="player-info">
                    <div class="section-title">–ü–µ—Ä—Å–æ–Ω–∞–∂</div>
                    <div class="health-bar">
                        <div class="health-fill" id="health-bar" style="width: 100%"></div>
                        <div class="bar-label">–ó–¥–æ—Ä–æ–≤—å–µ: <span id="health-value">100</span></div>
                    </div>
                    <div class="food-bar">
                        <div class="food-fill" id="food-bar" style="width: 100%"></div>
                        <div class="bar-label">–°—ã—Ç–æ—Å—Ç—å: <span id="food-value">100</span></div>
                    </div>
                    <div style="margin-top: 15px;">
                        <div>–£—Ä–æ–≤–µ–Ω—å: <span id="player-level">1</span></div>
                        <div>–û–ø—ã—Ç: <span id="player-xp">0</span>/100</div>
                    </div>
                </div>
            </div>
            
            <div id="canvas-wrapper">
                <canvas id="game-canvas"></canvas>
                
                <div id="mobile-controls">
                    <div class="mobile-btn" id="mobile-left">‚Üê</div>
                    <div class="mobile-btn" id="mobile-up">‚Üë</div>
                    <div class="mobile-btn" id="mobile-right">‚Üí</div>
                    <div class="mobile-btn" id="mobile-down">‚Üì</div>
                    <div class="mobile-btn" id="mobile-jump">‚ò∞</div>
                    <div class="mobile-btn" id="mobile-action">‚ö°</div>
                </div>
                
                <div id="toggle-sidebar">‚ò∞</div>
                
                <div id="minimap"></div>
                
                <div id="hotbar">
                    <!-- –•–æ—Ç–±–∞—Ä –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <div id="loading-screen">
        <div class="loader"></div>
        <div class="loading-text">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏—Ä–∞...</div>
        <div class="loading-subtext">Minecraft Web Edition</div>
        <div class="progress-bar">
            <div class="progress-fill" id="loading-progress"></div>
        </div>
        <div id="loading-status">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—Å—Ç—É—Ä...</div>
    </div>

    <!-- Three.js –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- PointerLockControls –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞ -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/PointerLockControls.min.js"></script>
    <!-- –®—Ä–∏—Ñ—Ç –¥–ª—è –∏–∫–æ–Ω–æ–∫ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script>
        // –ò–ì–†–û–í–´–ï –ö–û–ù–°–¢–ê–ù–¢–´
        const WORLD_SIZE = 64; // –†–∞–∑–º–µ—Ä –º–∏—Ä–∞ –≤ –±–ª–æ–∫–∞—Ö (64x64)
        const CHUNK_SIZE = 16; // –†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞
        const SEA_LEVEL = 10; // –£—Ä–æ–≤–µ–Ω—å –º–æ—Ä—è
        
        // –¢–∏–ø—ã –±–ª–æ–∫–æ–≤ –∏ –∏—Ö —Å–≤–æ–π—Å—Ç–≤–∞
        const BLOCK_TYPES = {
            air: { id: 0, name: '–í–æ–∑–¥—É—Ö', color: 0x000000, transparent: true, solid: false },
            grass: { id: 1, name: '–¢—Ä–∞–≤–∞', color: 0x7CFC00, transparent: false, solid: true, durability: 1 },
            dirt: { id: 2, name: '–ó–µ–º–ª—è', color: 0x8B4513, transparent: false, solid: true, durability: 1 },
            stone: { id: 3, name: '–ö–∞–º–µ–Ω—å', color: 0x808080, transparent: false, solid: true, durability: 3 },
            wood: { id: 4, name: '–î–µ—Ä–µ–≤–æ', color: 0x8B7355, transparent: false, solid: true, durability: 2 },
            leaf: { id: 5, name: '–õ–∏—Å—Ç–≤–∞', color: 0x32CD32, transparent: true, solid: true, durability: 1 },
            glass: { id: 6, name: '–°—Ç–µ–∫–ª–æ', color: 0xADD8E6, transparent: true, solid: true, durability: 1 },
            plank: { id: 7, name: '–î–æ—Å–∫–∏', color: 0xDEB887, transparent: false, solid: true, durability: 2 },
            stick: { id: 8, name: '–ü–∞–ª–∫–∞', color: 0xD2B48C, transparent: false, solid: false, stackable: true },
            coal: { id: 9, name: '–£–≥–æ–ª—å', color: 0x333333, transparent: false, solid: false, stackable: true },
            iron: { id: 10, name: '–ñ–µ–ª–µ–∑–æ', color: 0xC0C0C0, transparent: false, solid: false, stackable: true },
            diamond: { id: 11, name: '–ê–ª–º–∞–∑', color: 0x4EE2EC, transparent: false, solid: false, stackable: true }
        };

        // –†–µ—Ü–µ–ø—Ç—ã –∫—Ä–∞—Ñ—Ç–∞
        const CRAFTING_RECIPES = [
            // –î–æ—Å–∫–∏ –∏–∑ –¥–µ—Ä–µ–≤–∞
            {
                input: [[BLOCK_TYPES.wood.id, 0, 0], [0, 0, 0], [0, 0, 0]],
                output: { type: BLOCK_TYPES.plank.id, count: 4 }
            },
            // –ü–∞–ª–∫–∏ –∏–∑ –¥–æ—Å–æ–∫
            {
                input: [[0, 0, 0], [BLOCK_TYPES.plank.id, 0, 0], [BLOCK_TYPES.plank.id, 0, 0]],
                output: { type: BLOCK_TYPES.stick.id, count: 4 }
            },
            // –í–µ—Ä—Å—Ç–∞–∫ –∏–∑ –¥–æ—Å–æ–∫
            {
                input: [
                    [BLOCK_TYPES.plank.id, BLOCK_TYPES.plank.id, 0],
                    [BLOCK_TYPES.plank.id, BLOCK_TYPES.plank.id, 0],
                    [0, 0, 0]
                ],
                output: { type: BLOCK_TYPES.wood.id, count: 1 } // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –≤–µ—Ä—Å—Ç–∞–∫ = –¥–µ—Ä–µ–≤–æ
            }
        ];

        // –ò–ì–†–û–í–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        let scene, camera, renderer, controls;
        let world = []; // 3D-–º–∏—Ä –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
        let worldData = []; // –î–∞–Ω–Ω—ã–µ –º–∏—Ä–∞ –¥–ª—è –ª–æ–≥–∏–∫–∏
        let player = {
            position: new THREE.Vector3(0, 20, 0),
            velocity: new THREE.Vector3(0, 0, 0),
            health: 100,
            food: 100,
            level: 1,
            xp: 0,
            inventory: [],
            selectedSlot: 0,
            onGround: false
        };
        
        let dayTime = 0; // 0-1, –≥–¥–µ 0 = –ø–æ–ª–Ω–æ—á—å, 0.5 = –ø–æ–ª–¥–µ–Ω—å
        let daySpeed = 0.00005; // –°–∫–æ—Ä–æ—Å—Ç—å —Å–º–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–∏
        let blockCount = 0;
        let isGamePaused = false;
        let raycaster = new THREE.Raycaster();
        let mouse = new THREE.Vector2();
        let clock = new THREE.Clock();
        let sunLight, moonLight;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            updateLoadingStatus('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ü–µ–Ω—ã...', 10);
            
            // –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x87CEEB, 10, 200);
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–º–µ—Ä—ã –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.copy(player.position);
            
            // –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞
            renderer = new THREE.WebGLRenderer({ 
                canvas: document.getElementById('game-canvas'),
                antialias: true 
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            initControls();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Å–≤–µ—â–µ–Ω–∏—è
            setupLighting();
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏—Ä–∞
            updateLoadingStatus('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ª–∞–Ω–¥—à–∞—Ñ—Ç–∞...', 30);
            generateWorld();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            updateLoadingStatus('–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞...', 70);
            initUI();
            initInventory();
            initCrafting();
            initHotbar();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            setupEventListeners();
            
            // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
            updateLoadingStatus('–ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã...', 90);
            setTimeout(() => {
                document.getElementById('loading-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loading-screen').style.display = 'none';
                    animate();
                }, 1000);
            }, 500);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function initControls() {
            controls = new THREE.PointerLockControls(camera, document.body);
            
            // –ó–∞–ø—Ä–æ—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —É–∫–∞–∑–∞—Ç–µ–ª—è –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–∞–Ω–≤–∞—Å
            document.getElementById('game-canvas').addEventListener('click', () => {
                if (!isGamePaused) {
                    controls.lock();
                }
            });
            
            controls.addEventListener('lock', () => {
                console.log('–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ');
            });
            
            controls.addEventListener('unlock', () => {
                console.log('–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ');
            });
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Å–≤–µ—â–µ–Ω–∏—è
        function setupLighting() {
            // –°–æ–ª–Ω—Ü–µ
            sunLight = new THREE.DirectionalLight(0xffffff, 0.8);
            sunLight.position.set(100, 100, 100);
            sunLight.castShadow = true;
            sunLight.shadow.mapSize.width = 2048;
            sunLight.shadow.mapSize.height = 2048;
            scene.add(sunLight);
            
            // –õ—É–Ω–∞ (–Ω–æ—á–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ)
            moonLight = new THREE.DirectionalLight(0x6666ff, 0.1);
            moonLight.position.set(-100, 100, -100);
            scene.add(moonLight);
            
            // –†–∞—Å—Å–µ—è–Ω–Ω—ã–π —Å–≤–µ—Ç
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
            scene.add(ambientLight);
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏—Ä–∞
        function generateWorld() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–∏—Ä–∞
            worldData = new Array(WORLD_SIZE);
            for (let x = 0; x < WORLD_SIZE; x++) {
                worldData[x] = new Array(WORLD_SIZE);
                for (let z = 0; z < WORLD_SIZE; z++) {
                    worldData[x][z] = new Array(WORLD_SIZE).fill(0);
                }
            }
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—ã—Å–æ—Ç
            const heights = [];
            for (let x = 0; x < WORLD_SIZE; x++) {
                heights[x] = [];
                for (let z = 0; z < WORLD_SIZE; z++) {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —à—É–º –ü–µ—Ä–ª–∏–Ω–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—ã—Å–æ—Ç
                    const height = Math.floor(
                        SEA_LEVEL + 
                        Math.sin(x * 0.1) * 3 + 
                        Math.cos(z * 0.1) * 3 +
                        Math.sin(x * 0.05 + z * 0.05) * 5
                    );
                    heights[x][z] = Math.max(1, Math.min(WORLD_SIZE - 5, height));
                }
            }
            
            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏—Ä–∞ –±–ª–æ–∫–∞–º–∏
            for (let x = 0; x < WORLD_SIZE; x++) {
                for (let z = 0; z < WORLD_SIZE; z++) {
                    const height = heights[x][z];
                    
                    // –ó–µ–º–ª—è –∏ —Ç—Ä–∞–≤–∞
                    for (let y = 0; y < height; y++) {
                        if (y === height - 1) {
                            setBlock(x, y, z, BLOCK_TYPES.grass.id);
                        } else if (y >= height - 4) {
                            setBlock(x, y, z, BLOCK_TYPES.dirt.id);
                        } else {
                            setBlock(x, y, z, BLOCK_TYPES.stone.id);
                        }
                    }
                    
                    // –í–æ–¥–∞
                    for (let y = 0; y < SEA_LEVEL; y++) {
                        if (getBlock(x, y, z) === BLOCK_TYPES.air.id) {
                            // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –≤–æ–¥–∞ = –≤–æ–∑–¥—É—Ö
                        }
                    }
                    
                    // –î–µ—Ä–µ–≤—å—è
                    if (x > 5 && x < WORLD_SIZE - 5 && z > 5 && z < WORLD_SIZE - 5 && 
                        height > SEA_LEVEL + 2 && Math.random() < 0.02) {
                        generateTree(x, height, z);
                    }
                    
                    // –ü–µ—â–µ—Ä—ã
                    if (Math.random() < 0.005 && height > SEA_LEVEL + 10) {
                        generateCave(x, height - 5, z);
                    }
                    
                    // –†—É–¥—ã
                    if (height < SEA_LEVEL + 5 && Math.random() < 0.01) {
                        generateOreVein(x, Math.floor(height/2), z, BLOCK_TYPES.coal.id, 5);
                    }
                    if (height < SEA_LEVEL + 3 && Math.random() < 0.005) {
                        generateOreVein(x, Math.floor(height/3), z, BLOCK_TYPES.iron.id, 3);
                    }
                    if (height < SEA_LEVEL + 2 && Math.random() < 0.001) {
                        generateOreVein(x, Math.floor(height/4), z, BLOCK_TYPES.diamond.id, 2);
                    }
                }
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ 3D-–æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –≤–∏–¥–∏–º—ã—Ö –±–ª–æ–∫–æ–≤
            updateLoadingStatus('–°–æ–∑–¥–∞–Ω–∏–µ 3D-–æ–±—ä–µ–∫—Ç–æ–≤...', 50);
            for (let x = 0; x < WORLD_SIZE; x++) {
                for (let y = 0; y < WORLD_SIZE; y++) {
                    for (let z = 0; z < WORLD_SIZE; z++) {
                        const blockId = getBlock(x, y, z);
                        if (blockId !== BLOCK_TYPES.air.id) {
                            createBlockMesh(x, y, z, blockId);
                        }
                    }
                }
            }
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ—Ä–µ–≤–∞
        function generateTree(x, y, z) {
            // –°—Ç–≤–æ–ª (3-5 –±–ª–æ–∫–æ–≤ –≤—ã—Å–æ—Ç–æ–π)
            const trunkHeight = 3 + Math.floor(Math.random() * 3);
            for (let i = 0; i < trunkHeight; i++) {
                setBlock(x, y + i, z, BLOCK_TYPES.wood.id);
            }
            
            // –õ–∏—Å—Ç–≤–∞
            const leafStart = y + trunkHeight - 2;
            const leafEnd = y + trunkHeight + 1;
            for (let ly = leafStart; ly <= leafEnd; ly++) {
                for (let lx = x - 2; lx <= x + 2; lx++) {
                    for (let lz = z - 2; lz <= z + 2; lz++) {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –º–∏—Ä–∞
                        if (lx < 0 || lx >= WORLD_SIZE || lz < 0 || lz >= WORLD_SIZE || ly < 0 || ly >= WORLD_SIZE) {
                            continue;
                        }
                        
                        // –ù–µ —Å—Ç–∞–≤–∏–º –ª–∏—Å—Ç–≤—É –≤ —É–≥–ª–∞—Ö –Ω–∞ –Ω–∏–∂–Ω–µ–º —É—Ä–æ–≤–Ω–µ
                        if (ly === leafStart && Math.abs(lx - x) === 2 && Math.abs(lz - z) === 2) {
                            continue;
                        }
                        
                        // –ù–µ —Å—Ç–∞–≤–∏–º –ª–∏—Å—Ç–≤—É –≤–º–µ—Å—Ç–æ —Å—Ç–≤–æ–ª–∞
                        if (lx === x && lz === z && ly <= y + trunkHeight) {
                            continue;
                        }
                        
                        // –°–ª—É—á–∞–π–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –±–ª–æ–∫–∏ –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤–∏–¥–∞
                        if (Math.random() < 0.7) {
                            setBlock(lx, ly, lz, BLOCK_TYPES.leaf.id);
                        }
                    }
                }
            }
            
            // –í–µ—Ä—Ö—É—à–∫–∞
            setBlock(x, leafEnd + 1, z, BLOCK_TYPES.leaf.id);
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—â–µ—Ä—ã
        function generateCave(startX, startY, startZ) {
            const length = 10 + Math.floor(Math.random() * 20);
            let x = startX, y = startY, z = startZ;
            
            for (let i = 0; i < length; i++) {
                // –£–¥–∞–ª—è–µ–º –±–ª–æ–∫–∏ –¥–ª—è –ø–µ—â–µ—Ä—ã
                for (let dx = -2; dx <= 2; dx++) {
                    for (let dy = -2; dy <= 2; dy++) {
                        for (let dz = -2; dz <= 2; dz++) {
                            const dist = Math.sqrt(dx*dx + dy*dy + dz*dz);
                            if (dist <= 2) {
                                const bx = x + dx;
                                const by = y + dy;
                                const bz = z + dz;
                                
                                if (bx >= 0 && bx < WORLD_SIZE && 
                                    by >= 0 && by < WORLD_SIZE && 
                                    bz >= 0 && bz < WORLD_SIZE) {
                                    setBlock(bx, by, bz, BLOCK_TYPES.air.id);
                                }
                            }
                        }
                    }
                }
                
                // –°–ª—É—á–∞–π–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                x += Math.floor(Math.random() * 3) - 1;
                y += Math.floor(Math.random() * 3) - 1;
                z += Math.floor(Math.random() * 3) - 1;
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                x = Math.max(3, Math.min(WORLD_SIZE - 3, x));
                y = Math.max(3, Math.min(WORLD_SIZE - 3, y));
                z = Math.max(3, Math.min(WORLD_SIZE - 3, z));
            }
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∂–∏–ª—ã —Ä—É–¥—ã
        function generateOreVein(x, y, z, oreType, size) {
            for (let i = 0; i < size; i++) {
                for (let dx = -1; dx <= 1; dx++) {
                    for (let dy = -1; dy <= 1; dy++) {
                        for (let dz = -1; dz <= 1; dz++) {
                            if (Math.random() < 0.5) {
                                const bx = x + dx;
                                const by = y + dy;
                                const bz = z + dz;
                                
                                if (bx >= 0 && bx < WORLD_SIZE && 
                                    by >= 0 && by < WORLD_SIZE && 
                                    bz >= 0 && bz < WORLD_SIZE &&
                                    getBlock(bx, by, bz) === BLOCK_TYPES.stone.id) {
                                    setBlock(bx, by, bz, oreType);
                                }
                            }
                        }
                    }
                }
                
                // –°–ª—É—á–∞–π–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ
                x += Math.floor(Math.random() * 3) - 1;
                y += Math.floor(Math.random() * 3) - 1;
                z += Math.floor(Math.random() * 3) - 1;
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                x = Math.max(1, Math.min(WORLD_SIZE - 1, x));
                y = Math.max(1, Math.min(WORLD_SIZE - 1, y));
                z = Math.max(1, Math.min(WORLD_SIZE - 1, z));
            }
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–ª–æ–∫–∞ –≤ –¥–∞–Ω–Ω—ã—Ö –º–∏—Ä–∞
        function setBlock(x, y, z, blockId) {
            if (x >= 0 && x < WORLD_SIZE && y >= 0 && y < WORLD_SIZE && z >= 0 && z < WORLD_SIZE) {
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –º–µ—à, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
                const oldIndex = world.findIndex(b => 
                    Math.floor(b.position.x) === x && 
                    Math.floor(b.position.y) === y && 
                    Math.floor(b.position.z) === z
                );
                
                if (oldIndex !== -1) {
                    scene.remove(world[oldIndex]);
                    world.splice(oldIndex, 1);
                }
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π –±–ª–æ–∫
                worldData[x][z][y] = blockId;
                
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –º–µ—à, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –≤–æ–∑–¥—É—Ö
                if (blockId !== BLOCK_TYPES.air.id) {
                    createBlockMesh(x, y, z, blockId);
                }
                
                blockCount++;
                document.getElementById('block-count').textContent = blockCount;
            }
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–ª–æ–∫–∞ –∏–∑ –¥–∞–Ω–Ω—ã—Ö –º–∏—Ä–∞
        function getBlock(x, y, z) {
            if (x >= 0 && x < WORLD_SIZE && y >= 0 && y < WORLD_SIZE && z >= 0 && z < WORLD_SIZE) {
                return worldData[x][z][y];
            }
            return BLOCK_TYPES.air.id; // –ó–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –º–∏—Ä–∞ - –≤–æ–∑–¥—É—Ö
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ 3D-–æ–±—ä–µ–∫—Ç–∞ –±–ª–æ–∫–∞
        function createBlockMesh(x, y, z, blockId) {
            const blockType = Object.values(BLOCK_TYPES).find(b => b.id === blockId);
            if (!blockType || blockType.transparent) return;
            
            const geometry = new THREE.BoxGeometry(1, 1, 1);
            const material = new THREE.MeshLambertMaterial({ 
                color: blockType.color,
                transparent: blockType.transparent || false,
                opacity: blockType.transparent ? 0.7 : 1.0
            });
            
            const cube = new THREE.Mesh(geometry, material);
            cube.position.set(x, y, z);
            cube.castShadow = true;
            cube.receiveShadow = true;
            cube.userData = { type: blockId, x, y, z };
            
            scene.add(cube);
            world.push(cube);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function initUI() {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
            updatePlayerInfo();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∏–Ω–∏-–∫–∞—Ä—Ç—ã
            initMinimap();
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–∞–π–¥–±–∞—Ä–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
            document.getElementById('toggle-sidebar').addEventListener('click', () => {
                document.getElementById('sidebar').classList.toggle('open');
            });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function initInventory() {
            const inventorySlots = document.getElementById('inventory-slots');
            inventorySlots.innerHTML = '';
            
            // –ù–∞—á–∞–ª—å–Ω—ã–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
            player.inventory = [
                { type: BLOCK_TYPES.grass.id, count: 10 },
                { type: BLOCK_TYPES.dirt.id, count: 15 },
                { type: BLOCK_TYPES.wood.id, count: 5 },
                { type: BLOCK_TYPES.stone.id, count: 8 },
                { type: BLOCK_TYPES.plank.id, count: 0 },
                { type: BLOCK_TYPES.stick.id, count: 0 },
                { type: BLOCK_TYPES.coal.id, count: 0 },
                { type: BLOCK_TYPES.iron.id, count: 0 },
                { type: BLOCK_TYPES.diamond.id, count: 0 }
            ];
            
            // –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ—Ç–æ–≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            player.inventory.forEach((item, index) => {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot';
                slot.dataset.index = index;
                
                if (item && item.count > 0) {
                    const blockType = Object.values(BLOCK_TYPES).find(b => b.id === item.type);
                    slot.innerHTML = `
                        <div class="block-preview" style="background-color: #${blockType.color.toString(16).padStart(6, '0')}"></div>
                        <div class="slot-name">${blockType.name}</div>
                        <div class="slot-count">${item.count}</div>
                    `;
                }
                
                slot.addEventListener('click', () => {
                    // –í—ã–±–æ—Ä —Å–ª–æ—Ç–∞
                    document.querySelectorAll('.inventory-slot').forEach(s => s.classList.remove('selected'));
                    slot.classList.add('selected');
                    
                    if (item && item.count > 0) {
                        player.selectedSlot = index;
                        updateHotbar();
                    }
                });
                
                inventorySlots.appendChild(slot);
            });
            
            // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π —Å–ª–æ—Ç
            if (inventorySlots.firstChild) {
                inventorySlots.firstChild.click();
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫—Ä–∞—Ñ—Ç–∞
        function initCrafting() {
            const craftingGrid = document.getElementById('crafting-grid');
            craftingGrid.innerHTML = '';
            
            // –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ—Ç–æ–≤ –∫—Ä–∞—Ñ—Ç–∞ (3x3)
            for (let i = 0; i < 9; i++) {
                const slot = document.createElement('div');
                slot.className = 'crafting-slot';
                slot.dataset.index = i;
                slot.addEventListener('click', () => {
                    if (player.inventory[player.selectedSlot] && player.inventory[player.selectedSlot].count > 0) {
                        const selectedItem = player.inventory[player.selectedSlot];
                        slot.innerHTML = `
                            <div class="block-preview" style="background-color: #${Object.values(BLOCK_TYPES).find(b => b.id === selectedItem.type).color.toString(16).padStart(6, '0')}"></div>
                        `;
                        slot.dataset.block = selectedItem.type;
                        checkCraftingRecipe();
                    }
                });
                craftingGrid.appendChild(slot);
            }
            
            // –ö–Ω–æ–ø–∫–∞ –∫—Ä–∞—Ñ—Ç–∞
            document.getElementById('craft-btn').addEventListener('click', performCrafting);
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∫—Ä–∞—Ñ—Ç–∞
        function checkCraftingRecipe() {
            const craftingSlots = document.querySelectorAll('.crafting-slot');
            const grid = [];
            
            // –°–æ–±–∏—Ä–∞–µ–º —Å–µ—Ç–∫—É –∫—Ä–∞—Ñ—Ç–∞
            for (let i = 0; i < 9; i++) {
                const row = Math.floor(i / 3);
                const col = i % 3;
                
                if (!grid[row]) grid[row] = [];
                grid[row][col] = parseInt(craftingSlots[i].dataset.block) || 0;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã
            for (const recipe of CRAFTING_RECIPES) {
                let match = true;
                
                for (let r = 0; r < 3; r++) {
                    for (let c = 0; c < 3; c++) {
                        if (recipe.input[r][c] !== grid[r][c]) {
                            match = false;
                            break;
                        }
                    }
                    if (!match) break;
                }
                
                if (match) {
                    // –ù–∞—à–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ä–µ—Ü–µ–ø—Ç
                    const result = document.getElementById('craft-result');
                    const blockType = Object.values(BLOCK_TYPES).find(b => b.id === recipe.output.type);
                    result.innerHTML = `
                        <div class="block-preview" style="background-color: #${blockType.color.toString(16).padStart(6, '0')}"></div>
                        <div class="slot-count" style="bottom: 5px; right: 5px;">${recipe.output.count}</div>
                    `;
                    result.dataset.result = JSON.stringify(recipe.output);
                    
                    document.getElementById('craft-btn').disabled = false;
                    return;
                }
            }
            
            // –†–µ—Ü–µ–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
            document.getElementById('craft-result').innerHTML = '';
            document.getElementById('craft-result').dataset.result = '';
            document.getElementById('craft-btn').disabled = true;
        }
        
        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—Ä–∞—Ñ—Ç–∞
        function performCrafting() {
            const result = document.getElementById('craft-result').dataset.result;
            if (!result) return;
            
            const output = JSON.parse(result);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
            const existingItem = player.inventory.find(item => item.type === output.type);
            if (existingItem) {
                existingItem.count += output.count;
            } else {
                // –ò—â–µ–º –ø—É—Å—Ç–æ–π —Å–ª–æ—Ç
                const emptySlot = player.inventory.findIndex(item => item.count === 0);
                if (emptySlot !== -1) {
                    player.inventory[emptySlot] = { type: output.type, count: output.count };
                } else {
                    // –ù–µ—Ç –º–µ—Å—Ç–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ
                    alert('–ù–µ—Ç –º–µ—Å—Ç–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ!');
                    return;
                }
            }
            
            // –û—á–∏—â–∞–µ–º —Å–µ—Ç–∫—É –∫—Ä–∞—Ñ—Ç–∞
            document.querySelectorAll('.crafting-slot').forEach(slot => {
                slot.innerHTML = '';
                slot.dataset.block = '';
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateInventoryUI();
            checkCraftingRecipe();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ö–æ—Ç–±–∞—Ä–∞
        function initHotbar() {
            const hotbar = document.getElementById('hotbar');
            hotbar.innerHTML = '';
            
            // –°–æ–∑–¥–∞–Ω–∏–µ 9 —Å–ª–æ—Ç–æ–≤ —Ö–æ—Ç–±–∞—Ä–∞
            for (let i = 0; i < 9; i++) {
                const slot = document.createElement('div');
                slot.className = 'hotbar-slot';
                slot.dataset.index = i;
                
                slot.innerHTML = `
                    <div class="hotbar-number">${i + 1}</div>
                `;
                
                slot.addEventListener('click', () => {
                    selectHotbarSlot(i);
                });
                
                hotbar.appendChild(slot);
            }
            
            // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π —Å–ª–æ—Ç
            selectHotbarSlot(0);
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏—à 1-9 –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–ª–æ—Ç–æ–≤
            document.addEventListener('keydown', (e) => {
                const key = parseInt(e.key);
                if (key >= 1 && key <= 9) {
                    selectHotbarSlot(key - 1);
                }
            });
        }
        
        // –í—ã–±–æ—Ä —Å–ª–æ—Ç–∞ —Ö–æ—Ç–±–∞—Ä–∞
        function selectHotbarSlot(index) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ
            document.querySelectorAll('.hotbar-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            document.querySelector(`.hotbar-slot[data-index="${index}"]`).classList.add('selected');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–ª–æ—Ç –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            player.selectedSlot = index;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ö–æ—Ç–±–∞—Ä–∞
            updateHotbar();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ö–æ—Ç–±–∞—Ä–∞
        function updateHotbar() {
            const hotbarSlots = document.querySelectorAll('.hotbar-slot');
            
            player.inventory.forEach((item, index) => {
                if (index >= hotbarSlots.length) return;
                
                const slot = hotbarSlots[index];
                if (item && item.count > 0) {
                    const blockType = Object.values(BLOCK_TYPES).find(b => b.id === item.type);
                    slot.innerHTML = `
                        <div class="hotbar-number">${index + 1}</div>
                        <div class="block-preview" style="background-color: #${blockType.color.toString(16).padStart(6, '0')}"></div>
                        <div class="slot-count" style="bottom: 3px; right: 5px;">${item.count}</div>
                    `;
                } else {
                    slot.innerHTML = `<div class="hotbar-number">${index + 1}</div>`;
                }
            });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∏–Ω–∏-–∫–∞—Ä—Ç—ã
        function initMinimap() {
            // –ú–∏–Ω–∏-–∫–∞—Ä—Ç–∞ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –≤ –∞–Ω–∏–º–∞—Ü–∏–æ–Ω–Ω–æ–º —Ü–∏–∫–ª–µ
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∏–≥—Ä–æ–∫–µ
        function updatePlayerInfo() {
            // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
            document.getElementById('coordinates').textContent = 
                `X: ${Math.floor(player.position.x)}, Y: ${Math.floor(player.position.y)}, Z: ${Math.floor(player.position.z)}`;
            
            // –ó–¥–æ—Ä–æ–≤—å–µ –∏ —Å—ã—Ç–æ—Å—Ç—å
            document.getElementById('health-value').textContent = player.health;
            document.getElementById('health-bar').style.width = `${player.health}%`;
            
            document.getElementById('food-value').textContent = player.food;
            document.getElementById('food-bar').style.width = `${player.food}%`;
            
            // –£—Ä–æ–≤–µ–Ω—å –∏ –æ–ø—ã—Ç
            document.getElementById('player-level').textContent = player.level;
            document.getElementById('player-xp').textContent = player.xp;
            
            // –í—Ä–µ–º—è —Å—É—Ç–æ–∫
            const timeText = dayTime < 0.25 ? '–ù–æ—á—å' : 
                            dayTime < 0.5 ? '–£—Ç—Ä–æ' : 
                            dayTime < 0.75 ? '–î–µ–Ω—å' : '–í–µ—á–µ—Ä';
            document.getElementById('game-time').textContent = timeText;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –≤ UI
        function updateInventoryUI() {
            const inventorySlots = document.querySelectorAll('.inventory-slot');
            
            player.inventory.forEach((item, index) => {
                const slot = inventorySlots[index];
                if (item && item.count > 0) {
                    const blockType = Object.values(BLOCK_TYPES).find(b => b.id === item.type);
                    slot.innerHTML = `
                        <div class="block-preview" style="background-color: #${blockType.color.toString(16).padStart(6, '0')}"></div>
                        <div class="slot-name">${blockType.name}</div>
                        <div class="slot-count">${item.count}</div>
                    `;
                } else {
                    slot.innerHTML = '';
                }
            });
            
            updateHotbar();
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–ª–æ–∫–æ–º
        function handleBlockInteraction() {
            // –ë—Ä–æ—Å–∞–µ–º –ª—É—á –∏–∑ –∫–∞–º–µ—Ä—ã
            raycaster.setFromCamera(mouse, camera);
            
            // –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Å –±–ª–æ–∫–∞–º–∏
            const intersects = raycaster.intersectObjects(world);
            
            if (intersects.length > 0) {
                const intersect = intersects[0];
                const block = intersect.object;
                const faceNormal = intersect.face.normal;
                
                // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –Ω–æ–≤–æ–≥–æ –±–ª–æ–∫–∞ —Ä—è–¥–æ–º —Å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–Ω—ã–º
                const newX = Math.round(block.position.x + faceNormal.x);
                const newY = Math.round(block.position.y + faceNormal.y);
                const newZ = Math.round(block.position.z + faceNormal.z);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –±–ª–æ–∫ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ
                const selectedItem = player.inventory[player.selectedSlot];
                
                if (selectedItem && selectedItem.count > 0) {
                    // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ—Å—Ç–∞–≤–∏—Ç—å –±–ª–æ–∫
                    if (getBlock(newX, newY, newZ) === BLOCK_TYPES.air.id) {
                        setBlock(newX, newY, newZ, selectedItem.type);
                        selectedItem.count--;
                        
                        if (selectedItem.count === 0) {
                            player.inventory[player.selectedSlot] = null;
                        }
                        
                        updateInventoryUI();
                    }
                }
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –±–ª–æ–∫–∞
        function removeBlock() {
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(world);
            
            if (intersects.length > 0) {
                const intersect = intersects[0];
                const block = intersect.object;
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–∏–ø –±–ª–æ–∫–∞
                const blockType = Object.values(BLOCK_TYPES).find(b => b.id === block.userData.type);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
                let existingItem = player.inventory.find(item => item && item.type === block.userData.type);
                
                if (existingItem) {
                    existingItem.count++;
                } else {
                    // –ò—â–µ–º –ø—É—Å—Ç–æ–π —Å–ª–æ—Ç
                    const emptySlot = player.inventory.findIndex(item => !item || item.count === 0);
                    if (emptySlot !== -1) {
                        player.inventory[emptySlot] = { 
                            type: block.userData.type, 
                            count: 1 
                        };
                    }
                }
                
                // –£–¥–∞–ª—è–µ–º –±–ª–æ–∫ –∏–∑ –º–∏—Ä–∞
                setBlock(block.position.x, block.position.y, block.position.z, BLOCK_TYPES.air.id);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                updateInventoryUI();
                
                // –î–∞–µ–º –æ–ø—ã—Ç –∑–∞ –¥–æ–±—ã—á—É
                player.xp += 5;
                if (player.xp >= 100) {
                    player.level++;
                    player.xp = player.xp - 100;
                    player.health = 100; // –õ–µ—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è
                }
                updatePlayerInfo();
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            window.addEventListener('resize', onWindowResize);
            
            // –ö–ª–∏–∫–∏ –º—ã—à–∏
            document.addEventListener('mousedown', (e) => {
                if (controls.isLocked && !isGamePaused) {
                    if (e.button === 0) { // –õ–µ–≤–∞—è –∫–Ω–æ–ø–∫–∞ - —É–¥–∞–ª–∏—Ç—å –±–ª–æ–∫
                        removeBlock();
                    } else if (e.button === 2) { // –ü—Ä–∞–≤–∞—è –∫–Ω–æ–ø–∫–∞ - –ø–æ—Å—Ç–∞–≤–∏—Ç—å –±–ª–æ–∫
                        handleBlockInteraction();
                    }
                }
            });
            
            // –î–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∏
            document.addEventListener('mousemove', (e) => {
                // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º—ã—à–∏
                mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
            });
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
            const keys = {};
            document.addEventListener('keydown', (e) => {
                keys[e.key.toLowerCase()] = true;
                
                // –ü–∞—É–∑–∞ –∏–≥—Ä—ã –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Escape
                if (e.key === 'Escape') {
                    if (controls.isLocked) {
                        controls.unlock();
                    } else {
                        controls.lock();
                    }
                }
                
                // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–∞–π–¥–±–∞—Ä–∞
                if (e.key === 'i' || e.key === '–∏') {
                    document.getElementById('sidebar').classList.toggle('open');
                }
            });
            
            document.addEventListener('keyup', (e) => {
                keys[e.key.toLowerCase()] = false;
            });
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞
            function updatePlayerMovement() {
                if (!controls.isLocked || isGamePaused) return;
                
                const speed = 0.2;
                const velocity = player.velocity;
                
                // –î–≤–∏–∂–µ–Ω–∏–µ –≤–ø–µ—Ä–µ–¥/–Ω–∞–∑–∞–¥
                if (keys['w'] || keys['—Ü']) {
                    velocity.x -= Math.sin(camera.rotation.y) * speed;
                    velocity.z -= Math.cos(camera.rotation.y) * speed;
                }
                if (keys['s'] || keys['—ã']) {
                    velocity.x += Math.sin(camera.rotation.y) * speed;
                    velocity.z += Math.cos(camera.rotation.y) * speed;
                }
                
                // –î–≤–∏–∂–µ–Ω–∏–µ –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ
                if (keys['a'] || keys['—Ñ']) {
                    velocity.x -= Math.cos(camera.rotation.y) * speed;
                    velocity.z += Math.sin(camera.rotation.y) * speed;
                }
                if (keys['d'] || keys['–≤']) {
                    velocity.x += Math.cos(camera.rotation.y) * speed;
                    velocity.z -= Math.sin(camera.rotation.y) * speed;
                }
                
                // –ü—Ä—ã–∂–æ–∫
                if ((keys[' '] || keys['spacebar']) && player.onGround) {
                    velocity.y = 0.3;
                    player.onGround = false;
                }
                
                // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
                velocity.y -= 0.02;
                
                // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
                velocity.x *= 0.9;
                velocity.z *= 0.9;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π
                checkCollisions();
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞
                player.position.add(velocity);
                camera.position.copy(player.position);
                camera.position.y += 1.6; // –í—ã—Å–æ—Ç–∞ –≥–ª–∞–∑ –∏–≥—Ä–æ–∫–∞
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                updatePlayerInfo();
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –≤ –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            setInterval(updatePlayerMovement, 16); // ~60 FPS
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π
        function checkCollisions() {
            const pos = player.position;
            const vel = player.velocity;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–ª–∏–∑–∏–∏ –ø–æ –æ—Å—è–º
            player.onGround = false;
            
            // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π —Å –±–ª–æ–∫–∞–º–∏
            for (let dx = -0.5; dx <= 0.5; dx += 1) {
                for (let dy = -1; dy <= 0.5; dy += 1.5) {
                    for (let dz = -0.5; dz <= 0.5; dz += 1) {
                        const checkX = Math.floor(pos.x + dx + vel.x);
                        const checkY = Math.floor(pos.y + dy + vel.y);
                        const checkZ = Math.floor(pos.z + dz + vel.z);
                        
                        const blockId = getBlock(checkX, checkY, checkZ);
                        if (blockId !== BLOCK_TYPES.air.id) {
                            const blockType = Object.values(BLOCK_TYPES).find(b => b.id === blockId);
                            if (blockType && blockType.solid) {
                                // –ö–æ–ª–ª–∏–∑–∏—è –ø–æ Y (–ø–æ–ª)
                                if (dy < 0 && vel.y < 0) {
                                    player.position.y = checkY + 1.5;
                                    vel.y = 0;
                                    player.onGround = true;
                                }
                                // –ö–æ–ª–ª–∏–∑–∏—è –ø–æ Y (–ø–æ—Ç–æ–ª–æ–∫)
                                if (dy > 0 && vel.y > 0) {
                                    player.position.y = checkY - 0.5;
                                    vel.y = 0;
                                }
                                // –ö–æ–ª–ª–∏–∑–∏—è –ø–æ X
                                if (dx !== 0) {
                                    vel.x = 0;
                                }
                                // –ö–æ–ª–ª–∏–∑–∏—è –ø–æ Z
                                if (dz !== 0) {
                                    vel.z = 0;
                                }
                            }
                        }
                    }
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        function updateLoadingStatus(text, progress) {
            document.getElementById('loading-status').textContent = text;
            document.getElementById('loading-progress').style.width = `${progress}%`;
        }
        
        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function animate() {
            requestAnimationFrame(animate);
            
            if (isGamePaused) return;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫
            dayTime += daySpeed;
            if (dayTime >= 1) dayTime = 0;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å–≤–µ—â–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫
            const sunIntensity = Math.max(0.1, Math.sin(dayTime * Math.PI * 2) * 0.5 + 0.5);
            sunLight.intensity = sunIntensity * 0.8;
            moonLight.intensity = (1 - sunIntensity) * 0.3;
            
            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–ª–Ω—Ü–∞ –∏ –ª—É–Ω—ã
            const sunAngle = dayTime * Math.PI * 2;
            sunLight.position.x = Math.cos(sunAngle) * 100;
            sunLight.position.y = Math.sin(sunAngle) * 100 + 50;
            sunLight.position.z = Math.sin(sunAngle) * 100;
            
            moonLight.position.x = Math.cos(sunAngle + Math.PI) * 100;
            moonLight.position.y = Math.sin(sunAngle + Math.PI) * 100 + 50;
            moonLight.position.z = Math.sin(sunAngle + Math.PI) * 100;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –Ω–µ–±–∞
            const skyColor = new THREE.Color();
            if (dayTime < 0.25 || dayTime > 0.75) {
                // –ù–æ—á—å
                skyColor.setHSL(0.7, 0.5, 0.1);
            } else if (dayTime < 0.5) {
                // –£—Ç—Ä–æ/–¥–µ–Ω—å
                const t = (dayTime - 0.25) * 4;
                skyColor.setHSL(0.6, 0.7, 0.5 + t * 0.3);
            } else {
                // –í–µ—á–µ—Ä
                const t = (0.75 - dayTime) * 4;
                skyColor.setHSL(0.05, 0.8, 0.4 + t * 0.2);
            }
            scene.fog.color.copy(skyColor);
            scene.background = skyColor;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—É–º–∞–Ω–∞
            scene.fog.near = 20;
            scene.fog.far = 150;
            
            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—Ü–µ–Ω—ã
            renderer.render(scene, camera);
        }
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            setTimeout(() => {
                initGame();
            }, 500);
        });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
        document.addEventListener('contextmenu', e => e.preventDefault());
    </script>
</body>
</html>
