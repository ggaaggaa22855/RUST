<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft в браузере</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a2e;
            color: #f0f0f0;
            overflow: hidden;
            height: 100vh;
        }
        
        #game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        #header {
            padding: 15px;
            background-color: rgba(30, 30, 46, 0.9);
            border-bottom: 2px solid #4a4a6d;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }
        
        h1 {
            color: #4ecdc4;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            font-size: 28px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
        }
        
        .controls {
            display: flex;
            gap: 15px;
        }
        
        button {
            padding: 10px 20px;
            background-color: #4a4a6d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        button:hover {
            background-color: #5a5a8d;
            transform: translateY(-2px);
        }
        
        #block-selector {
            display: flex;
            gap: 10px;
            background-color: rgba(30, 30, 46, 0.8);
            padding: 10px;
            border-radius: 8px;
            margin-left: 20px;
        }
        
        .block-type {
            width: 40px;
            height: 40px;
            border-radius: 5px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .block-type.selected {
            border-color: #4ecdc4;
            transform: scale(1.1);
        }
        
        #game-ui {
            display: flex;
            justify-content: space-between;
            padding: 10px 20px;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .ui-panel {
            display: flex;
            flex-direction: column;
            gap: 5px;
            background-color: rgba(30, 30, 46, 0.7);
            padding: 10px;
            border-radius: 8px;
            min-width: 200px;
        }
        
        .ui-title {
            color: #4ecdc4;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 18px;
        }
        
        #canvas-container {
            flex-grow: 1;
            overflow: hidden;
        }
        
        #info-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
            z-index: 5;
        }
        
        .instruction {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .key {
            display: inline-block;
            padding: 3px 8px;
            background-color: #333;
            border-radius: 4px;
            font-family: monospace;
            border: 1px solid #555;
            min-width: 30px;
            text-align: center;
        }
        
        #loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #1a1a2e;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 1s;
        }
        
        .loader {
            border: 8px solid rgba(78, 205, 196, 0.2);
            border-top: 8px solid #4ecdc4;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .block {
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-right: 5px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        #block-counter {
            font-size: 20px;
            font-weight: bold;
            color: #4ecdc4;
        }
        
        #coordinates {
            font-family: monospace;
            font-size: 18px;
        }
        
        .grass { background-color: #7CFC00; }
        .dirt { background-color: #8B4513; }
        .stone { background-color: #808080; }
        .wood { background-color: #8B7355; }
        .leaf { background-color: #32CD32; }
        .glass { background-color: rgba(173, 216, 230, 0.7); }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="header">
            <div class="logo">
                <div class="logo-icon">M</div>
                <h1>BrowserCraft</h1>
            </div>
            
            <div id="block-selector">
                <div class="block-type grass selected" data-type="grass" title="Трава"></div>
                <div class="block-type dirt" data-type="dirt" title="Земля"></div>
                <div class="block-type stone" data-type="stone" title="Камень"></div>
                <div class="block-type wood" data-type="wood" title="Дерево"></div>
                <div class="block-type leaf" data-type="leaf" title="Листва"></div>
                <div class="block-type glass" data-type="glass" title="Стекло"></div>
            </div>
            
            <div class="controls">
                <button id="reset-btn">Новый мир</button>
                <button id="toggle-ui">Скрыть UI</button>
            </div>
        </div>
        
        <div id="game-ui">
            <div class="ui-panel">
                <div class="ui-title">Статистика</div>
                <div>Поставлено блоков: <span id="block-counter">0</span></div>
                <div>Координаты: <span id="coordinates">X: 0, Y: 5, Z: 0</span></div>
                <div>Выбранный блок: <span id="selected-block-name">Трава</span></div>
            </div>
            
            <div class="ui-panel">
                <div class="ui-title">Управление</div>
                <div class="instruction">
                    <span class="key">WASD</span> <span>Движение</span>
                </div>
                <div class="instruction">
                    <span class="key">ЛКМ</span> <span>Удалить блок</span>
                </div>
                <div class="instruction">
                    <span class="key">ПКМ</span> <span>Поставить блок</span>
                </div>
                <div class="instruction">
                    <span class="key">Пробел</span> <span>Прыжок</span>
                </div>
                <div class="instruction">
                    <span class="key">Shift</span> <span>Присесть</span>
                </div>
            </div>
        </div>
        
        <div id="canvas-container"></div>
        
        <div id="info-panel">
            <div style="margin-bottom: 10px; color: #4ecdc4; font-weight: bold;">Добро пожаловать в BrowserCraft!</div>
            <div>Создавайте и разрушайте блоки, исследуйте мир. Используйте колесо мыши для изменения скорости.</div>
        </div>
    </div>
    
    <div id="loading">
        <div class="loader"></div>
        <h2 style="color: #4ecdc4; margin-bottom: 10px;">Загрузка мира...</h2>
        <p>Пожалуйста, подождите</p>
    </div>

    <!-- Three.js библиотека -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- OrbitControls для управления камерой -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    
    <script>
        // Основные переменные
        let scene, camera, renderer, controls;
        let world = [];
        let blockCount = 0;
        let selectedBlockType = 'grass';
        let uiVisible = true;
        let mouse = { x: 0, y: 0 };
        let raycaster = new THREE.Raycaster();
        
        // Цвета блоков в Minecraft-стиле
        const blockColors = {
            grass: 0x7CFC00,
            dirt: 0x8B4513,
            stone: 0x808080,
            wood: 0x8B7355,
            leaf: 0x32CD32,
            glass: 0xADD8E6
        };
        
        // Инициализация сцены
        function init() {
            // Создание сцены
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB); // Небесно-голубой
            
            // Добавление освещения
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 100, 50);
            scene.add(directionalLight);
            
            // Создание камеры
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(20, 20, 20);
            
            // Создание рендерера
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            // Добавление управления камерой
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.screenSpacePanning = false;
            controls.minDistance = 5;
            controls.maxDistance = 100;
            controls.maxPolarAngle = Math.PI / 2 - 0.1; // Ограничение угла обзора
            
            // Создание простого мира
            createWorld();
            
            // Добавление обработчиков событий
            setupEventListeners();
            
            // Скрытие загрузочного экрана
            setTimeout(() => {
                document.getElementById('loading').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                }, 1000);
            }, 1500);
            
            // Запуск анимации
            animate();
        }
        
        // Создание мира
        function createWorld() {
            // Очистка существующего мира
            world.forEach(block => {
                scene.remove(block);
            });
            world = [];
            blockCount = 0;
            document.getElementById('block-counter').textContent = blockCount;
            
            // Создание земли
            for (let x = -10; x <= 10; x++) {
                for (let z = -10; z <= 10; z++) {
                    // Основание из земли
                    addBlock(x, -1, z, 'dirt');
                    
                    // Трава сверху
                    if (x >= -8 && x <= 8 && z >= -8 && z <= 8) {
                        addBlock(x, 0, z, 'grass');
                    } else {
                        addBlock(x, 0, z, 'dirt');
                    }
                }
            }
            
            // Создание нескольких деревьев
            const treePositions = [
                {x: -5, z: -5},
                {x: 5, z: -5},
                {x: -5, z: 5},
                {x: 5, z: 5},
                {x: 0, z: 0}
            ];
            
            treePositions.forEach(pos => {
                // Ствол дерева
                for (let y = 1; y <= 4; y++) {
                    addBlock(pos.x, y, pos.z, 'wood');
                }
                
                // Листва дерева
                for (let dx = -2; dx <= 2; dx++) {
                    for (let dz = -2; dz <= 2; dz++) {
                        for (let dy = 4; dy <= 6; dy++) {
                            // Исключаем углы для более естественной формы
                            if (Math.abs(dx) === 2 && Math.abs(dz) === 2 && dy > 4) continue;
                            
                            // Не ставим листву в центре (там ствол)
                            if (dx === 0 && dz === 0 && dy <= 4) continue;
                            
                            addBlock(pos.x + dx, dy, pos.z + dz, 'leaf');
                        }
                    }
                }
                
                // Верхушка дерева
                addBlock(pos.x, 7, pos.z, 'leaf');
            });
            
            // Создание каменной горки
            for (let i = 0; i < 5; i++) {
                for (let j = 0; j <= i; j++) {
                    for (let k = 0; k <= i; k++) {
                        if (i === 4 && j > 2 && k > 2) continue; // Делаем вершину меньше
                        addBlock(-8 + j, i, -8 + k, 'stone');
                    }
                }
            }
            
            // Создание стеклянной конструкции
            for (let y = 1; y <= 3; y++) {
                for (let x = -1; x <= 1; x++) {
                    addBlock(8 + x, y, 8, 'glass');
                    addBlock(8 + x, y, 6, 'glass');
                }
                for (let z = 0; z <= 2; z++) {
                    addBlock(7, y, 8 - z, 'glass');
                    addBlock(9, y, 8 - z, 'glass');
                }
            }
            addBlock(8, 4, 7, 'glass');
        }
        
        // Добавление блока
        function addBlock(x, y, z, type) {
            // Проверяем, есть ли уже блок на этой позиции
            const existingBlock = world.find(block => 
                block.position.x === x && 
                block.position.y === y && 
                block.position.z === z
            );
            
            if (existingBlock) return; // Блок уже существует
            
            // Создаем геометрию куба
            const geometry = new THREE.BoxGeometry(1, 1, 1);
            
            // Создаем материал с цветом в зависимости от типа блока
            const material = new THREE.MeshLambertMaterial({ 
                color: blockColors[type],
                transparent: type === 'glass',
                opacity: type === 'glass' ? 0.7 : 1.0
            });
            
            // Создаем меш (объект)
            const cube = new THREE.Mesh(geometry, material);
            cube.position.set(x, y, z);
            cube.castShadow = true;
            cube.receiveShadow = true;
            
            // Сохраняем тип блока как пользовательское свойство
            cube.userData.type = type;
            
            // Добавляем в сцену и массив мира
            scene.add(cube);
            world.push(cube);
            
            // Обновляем счетчик
            blockCount++;
            document.getElementById('block-counter').textContent = blockCount;
        }
        
        // Удаление блока
        function removeBlock(x, y, z) {
            // Находим блок на этой позиции
            const blockIndex = world.findIndex(block => 
                Math.floor(block.position.x) === x && 
                Math.floor(block.position.y) === y && 
                Math.floor(block.position.z) === z
            );
            
            if (blockIndex !== -1) {
                // Удаляем блок из сцены
                scene.remove(world[blockIndex]);
                // Удаляем из массива
                world.splice(blockIndex, 1);
                
                // Обновляем счетчик
                blockCount--;
                document.getElementById('block-counter').textContent = blockCount;
                return true;
            }
            return false;
        }
        
        // Настройка обработчиков событий
        function setupEventListeners() {
            // Изменение размера окна
            window.addEventListener('resize', onWindowResize);
            
            // Обработка кликов мыши
            renderer.domElement.addEventListener('click', onMouseClick);
            
            // Обработка движения мыши
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            
            // Выбор типа блока
            document.querySelectorAll('.block-type').forEach(blockType => {
                blockType.addEventListener('click', function() {
                    // Убираем выделение со всех блоков
                    document.querySelectorAll('.block-type').forEach(b => {
                        b.classList.remove('selected');
                    });
                    
                    // Выделяем выбранный блок
                    this.classList.add('selected');
                    selectedBlockType = this.dataset.type;
                    
                    // Обновляем название выбранного блока
                    const blockNames = {
                        grass: 'Трава',
                        dirt: 'Земля',
                        stone: 'Камень',
                        wood: 'Дерево',
                        leaf: 'Листва',
                        glass: 'Стекло'
                    };
                    document.getElementById('selected-block-name').textContent = blockNames[selectedBlockType];
                });
            });
            
            // Кнопка сброса мира
            document.getElementById('reset-btn').addEventListener('click', createWorld);
            
            // Кнопка скрытия/показа UI
            document.getElementById('toggle-ui').addEventListener('click', function() {
                uiVisible = !uiVisible;
                const uiElements = document.getElementById('game-ui');
                const infoPanel = document.getElementById('info-panel');
                
                if (uiVisible) {
                    uiElements.style.display = 'flex';
                    infoPanel.style.display = 'block';
                    this.textContent = 'Скрыть UI';
                } else {
                    uiElements.style.display = 'none';
                    infoPanel.style.display = 'none';
                    this.textContent = 'Показать UI';
                }
            });
            
            // Обработка клавиш для управления
            document.addEventListener('keydown', onKeyDown);
        }
        
        // Обработка изменения размера окна
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // Обработка движения мыши
        function onMouseMove(event) {
            // Вычисляем позицию мыши в нормализованных координатах устройства
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            // Обновляем координаты камеры в UI
            updateCoordinates();
        }
        
        // Обработка клика мыши
        function onMouseClick(event) {
            // Устанавливаем начало луча из позиции камеры
            raycaster.setFromCamera(mouse, camera);
            
            // Вычисляем пересечения луча с объектами сцены
            const intersects = raycaster.intersectObjects(world);
            
            if (intersects.length > 0) {
                const intersect = intersects[0];
                const block = intersect.object;
                const faceNormal = intersect.face.normal;
                
                // Вычисляем позицию нового блока рядом с пересеченным
                const newX = Math.round(block.position.x + faceNormal.x);
                const newY = Math.round(block.position.y + faceNormal.y);
                const newZ = Math.round(block.position.z + faceNormal.z);
                
                if (event.button === 0) { // Левая кнопка мыши - удалить блок
                    removeBlock(block.position.x, block.position.y, block.position.z);
                } else if (event.button === 2) { // Правая кнопка мыши - добавить блок
                    addBlock(newX, newY, newZ, selectedBlockType);
                }
                
                event.preventDefault();
            }
        }
        
        // Обработка нажатия клавиш
        function onKeyDown(event) {
            // Управление камерой
            const moveSpeed = 0.5;
            
            switch(event.key.toLowerCase()) {
                case 'w':
                    camera.position.x -= Math.sin(camera.rotation.y) * moveSpeed;
                    camera.position.z -= Math.cos(camera.rotation.y) * moveSpeed;
                    break;
                case 's':
                    camera.position.x += Math.sin(camera.rotation.y) * moveSpeed;
                    camera.position.z += Math.cos(camera.rotation.y) * moveSpeed;
                    break;
                case 'a':
                    camera.position.x -= Math.cos(camera.rotation.y) * moveSpeed;
                    camera.position.z += Math.sin(camera.rotation.y) * moveSpeed;
                    break;
                case 'd':
                    camera.position.x += Math.cos(camera.rotation.y) * moveSpeed;
                    camera.position.z -= Math.sin(camera.rotation.y) * moveSpeed;
                    break;
                case ' ':
                    camera.position.y += moveSpeed; // Прыжок
                    break;
                case 'shift':
                    camera.position.y -= moveSpeed; // Присесть
                    break;
            }
            
            updateCoordinates();
        }
        
        // Обновление координат в UI
        function updateCoordinates() {
            const x = Math.round(camera.position.x);
            const y = Math.round(camera.position.y);
            const z = Math.round(camera.position.z);
            document.getElementById('coordinates').textContent = `X: ${x}, Y: ${y}, Z: ${z}`;
        }
        
        // Анимация
        function animate() {
            requestAnimationFrame(animate);
            
            // Обновление контролов камеры
            controls.update();
            
            // Вращение солнца (направленного света) для симуляции дня/ночи
            const time = Date.now() * 0.0005;
            const light = scene.children.find(child => child instanceof THREE.DirectionalLight);
            if (light) {
                light.position.x = Math.cos(time) * 100;
                light.position.z = Math.sin(time) * 100;
            }
            
            // Рендеринг сцены
            renderer.render(scene, camera);
        }
        
        // Запуск приложения после загрузки страницы
        window.addEventListener('load', init);
        
        // Предотвращение контекстного меню для правой кнопки мыши
        document.addEventListener('contextmenu', event => event.preventDefault());
    </script>
</body>
</html>s
